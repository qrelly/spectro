{"version":3,"sources":["spectro.coffee","spectro.js"],"names":["Spectro","_base","_base1","__extends","child","parent","ctor","this","constructor","key","__hasProp","call","prototype","__super__","hasOwnProperty","__slice","slice","Helper","registry","push","$container","$target","clean","helper","_i","_len","_results","length","destroy","show","hide","remove","Controls","_super","_at_$target","$moveAction","$removeAction","$setupAction","controls","label","apply","arguments","data","attr","prop","$","fn","spectro","i18n","setup","move","appendTo","on","_this","is","focus","find","event","stopPropagation","addClass","defaults","removedElementClass","preventDefault","$draggedElement","isDrag","activeClass","hoveredElementClass","update","css","width","outerWidth","top","offset","left","removeClass","Sidebar","initialLocation","height","outerHeight","Breadcrumbs","get","reset","html","add","callback","$crumb","append","Placeholder","draggedElementDropBefore","Popover","$scheme","$window","box","drops","popover","range","scrollLeft","scrollTop","selection","children","window","getRangeAt","cloneRange","getBoundingClientRect","each","$drop","$element","$ghost","$label","property","tagName","_ref","text","$newElement","attribute","error","_j","_len1","_ref1","attributes","name","startsWith","value","surroundContents","_error","extend","expr","void","element","indexOf","toLowerCase","spectro-editable","hasClass","enabledElementClass","spectro-setupable","spectro-draggable","$this","spectro-removeable","spectro-controlable","parents","draggedElementClass","spectro-inline","filter","String","s","endsWith","getSelection","isCollapsed","toString","replace","anchorNode","parentElement","jQuery","methods","document","documentDraggedClass","$lastDragoveredElement","before","after","enable","options","breadcrumbs","scheme","XMLDocument","firstChild","documentEnabledClass","tabindex","aria-label","trigger","placeholder","pageY","contenteditable","i","spacesCount","string","test","setEnd","endContainer","endOffset","removeAllRanges","addRange","removeAttr","$parent","path","activeElementClass","reverse","$item","index","$clone","keyCode","blur","execCommand","originalEvent","clipboardData","getData","$child","childTagName","accepts","disable","off","enabled","disabled","method","console","warn","init"],"mappings":"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","file":"spectro.js","sourcesContent":["# Spectro namespace\r\nclass Spectro\r\t# Spectro base helper class\r\n\tclass Spectro.Helper\r\n\t\tregistry = []\r\n\t\t$container: null\r\n\t\t$target: null\r\n\t\t\r\n\t\t@clean: ->\r\n\t\t\tfor helper in registry\r\n\t\t\t\thelper.destroy()\r\n\t\r\n\t\tconstructor: ->\r\n\t\t\tregistry.push this\r\n\t\r\n\t\tshow: -> null\r\n\t\t\r\n\t\thide: -> null\r\n\t\r\n\t\tdestroy: ->\r\n\t\t\tif this.$container?\r\n\t\t\t\tthis.$container.remove()\r\n\t\t\t\tthis.$container = null\n\r\t# Spectro element controls helper\r\n\tclass Spectro.Controls extends Spectro.Helper\r\n\t\tdefaults:\r\n\t\t\tactiveClass: 'spectro-controls--active'\r\n\t\t\r\n\t\tconstructor: (@$target) ->\r\n\t\t\tsuper\r\n\t\r\n\t\t\tlabel = @$target.data('scheme').attr('spectro-label') or @$target.prop('tagName')\r\n\t\r\n\t\t\t@$container = $ \"\"\"\r\n\t\t\t\t<div class=\"spectro-controls spectro-helper\">\r\n\t\t\t\t\t<ul class=\"spectro-controls__toolbar\">\r\n\t\t\t\t\t\t<li class=\"spectro-controls__toolbar__tool spectro-controls__toolbar__tool--label\" title=\"#{$.fn.spectro.i18n.setup}\">#{label}</li>\r\n\t\t\t\t\t\t<li class=\"spectro-controls__toolbar__tool spectro-controls__toolbar__tool--handle\" title=\"#{$.fn.spectro.i18n.move}\"></li>\r\n\t\t\t\t\t\t<li class=\"spectro-controls__toolbar__tool spectro-controls__toolbar__tool--remove\" title=\"#{$.fn.spectro.i18n.remove}\"></li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t\"\"\"\r\n\t\t\t.appendTo 'body'\r\n\t\t\t.on 'mouseover.spectro', =>\r\n\t\t\t\t@show()\r\n\t\t\t.on 'mouseleave.spectro', =>\r\n\t\t\t\tif not @$target.is ':focus' then @hide()\r\n\t\t\t.on 'click.spectro', =>\r\n\t\t\t\t@$target.focus()\r\n\t\r\n\t\t\t$target = @$target\r\n\t\t\tcontrols = @\r\n\t\r\n\t\t\t$removeAction = @$container.find '.spectro-controls__toolbar__tool--remove'\r\n\t\t\t$moveAction = @$container.find '.spectro-controls__toolbar__tool--handle'\r\n\t\t\t$setupAction = @$container.find '.spectro-controls__toolbar__tool--label'\r\n\t\r\n\t\t\t# Remove action\r\n\t\t\tif $target.is ':spectro-removeable'\r\n\t\t\t\t$removeAction\r\n\t\t\t\t\t.show()\r\n\t\t\t\t\t.on 'mousedown touchstart', (event) ->\r\n\t\t\t\t\tevent.stopPropagation()\r\n\t\r\n\t\t\t\t\t$target\r\n\t\t\t\t\t\t.addClass $.fn.spectro.defaults.removedElementClass\r\n\t\t\t\t\t\t.on 'transitionend oTransitionEnd otransitionend webkitTransitionEnd', =>\r\n\t\t\t\t\t\t\t$target.remove()\r\n\t\r\n\t\t\t\t\tcontrols.hide()\r\n\t\t\telse\r\n\t\t\t\t$removeAction.hide()\r\n\t\r\n\t\t\t# Drag and drop\r\n\t\t\tif $target.is ':spectro-draggable'\r\n\t\t\t\t$moveAction\r\n\t\t\t\t\t.show()\r\n\t\t\t\t\t.on 'mousedown touchstart', (event) ->\r\n\t\t\t\t\t\tevent.preventDefault()\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$.fn.spectro.$draggedElement = $target\r\n\t\t\t\t\t\t$.fn.spectro.isDrag = true\r\n\t\t\telse\r\n\t\t\t\t$moveAction.hide()\r\n\t\r\n\t\t\t# Properties setup\r\n\t\t\tif $target.is ':setupable'\r\n\t\t\t\t$setupAction\r\n\t\t\t\t\t.show()\r\n\t\t\t\t\t.on 'mousedown touchstart', (event) ->\r\n\t\t\t\t\t\tevent.preventDefault()\r\n\t\r\n\t\t\t\t\t\t#$label = $ this\r\n\t\r\n\t\t\t\t\t\t#initialLocation =\r\n\t\t\t\t\t\t#\ttop: $label.offset().top\r\n\t\t\t\t\t\t#\tleft: $label.offset().left\r\n\t\t\t\t\t\t#\twidth: $label.outerWidth()\r\n\t\t\t\t\t\t#\theight: $label.outerHeight()\r\n\t\r\n\t\t\t\t\t\t#sidebar = new Spectro.Sidebar $target, initialLocation\r\n\t\t\telse\r\n\t\t\t\t$setupAction.hide()\r\n\t\r\n\t\tshow: ->\r\n\t\t\tcontrols = this\r\n\t\r\n\t\t\t# Prevent removed elements, dragged elements and already focused elements to be focused\r\n\t\t\tif not @$target.is ':spectro-controlable' then return\r\n\t\r\n\t\t\t@$target.addClass $.fn.spectro.defaults.hoveredElementClass\r\n\t\t\t@$container.addClass @defaults.activeClass\r\n\t\t\t@update()\r\n\t\r\n\t\tupdate: ->\r\n\t\t\t@$container.css\r\n\t\t\t\twidth: @$target.outerWidth()\r\n\t\t\t\ttop: @$target.offset().top\r\n\t\t\t\tleft: @$target.offset().left\r\n\t\r\n\t\thide: ->\r\n\t\t\t@$container.removeClass @defaults.activeClass\r\n\t\t\t@$target.removeClass $.fn.spectro.defaults.hoveredElementClass\n\r\t# Spectro sidebar helper\r\n\tclass Spectro.Sidebar extends Spectro.Helper\r\n\t\tconstructor: (@$target, initialLocation) ->\r\n\t\t\tsuper\r\n\t\r\n\t\t\t# Use target as initial location\r\n\t\t\tinitialLocation ?=\r\n\t\t\t\ttop: $target.offset().top\r\n\t\t\t\tleft: $target.offset().left\r\n\t\t\t\twidth: $target.outerWidth()\r\n\t\t\t\theight: $target.outerHeight()\r\n\t\r\n\t\t\t# Setup container\r\n\t\t\t@$container = '''\r\n\t\t\t'''\r\n\t\t\t.appendTo 'body'\n\r\t# Spectro breadcrumbs helper\r\n\tclass Spectro.Breadcrumbs\r\n\t\t$container = null\r\n\t\r\n\t\t@get: ->\r\n\t\t\tif not $container?\r\n\t\t\t\t$container = $ '''\r\n\t\t\t\t\t<div class=\"spectro-breadcrumbs spectro-helper\">\r\n\t\t\t\t\t\t<ul class=\"spectro-breadcrumbs__list\"></ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t'''\r\n\t\t\t\t.appendTo 'body'\r\n\t\r\n\t\t\treturn @\r\n\t\r\n\t\t@destroy: ->\r\n\t\t\tif $container?\r\n\t\t\t\t$container.remove()\r\n\t\t\t\t$container = null\r\n\t\r\n\t\t@show: ->\r\n\t\t\t$container.addClass 'spectro-breadcrumbs--active'\r\n\t\r\n\t\t@reset: ->\r\n\t\t\t$container\r\n\t\t\t\t.find '.spectro-breadcrumbs__list'\r\n\t\t\t\t.html ''\r\n\t\r\n\t\t@add: (label, callback) ->\r\n\t\t\t$crumb = $ \"\"\"\r\n\t\t\t\t<li class=\"spectro-breadcrumbs__list-item\" tabindex=\"0\">#{label}</li>\r\n\t\t\t\"\"\"\r\n\t\t\t.on 'click.spectro', ->\r\n\t\t\t\tcallback()\r\n\t\r\n\t\t\t$container\r\n\t\t\t\t.find '.spectro-breadcrumbs__list'\r\n\t\t\t\t.append $crumb\t\n\r\t# Spectro placeholder helper\r\n\tclass Spectro.Placeholder\r\n\t\t$container = null\r\n\t\r\n\t\t@get: ->\r\n\t\t\tif not $container?\r\n\t\t\t\t$container = $ '''\r\n\t\t\t\t\t<div class=\"spectro-placeholder spectro-placeholder--horizontal spectro-helper\">\r\n\t\t\t\t\t\t<hr class=\"spectro-placeholder__line\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t'''\r\n\t\t\t\t.appendTo 'body'\r\n\t\r\n\t\t\treturn @\r\n\t\r\n\t\t@destroy: ->\r\n\t\t\tif $container?\r\n\t\t\t\t$container.remove()\r\n\t\t\t\t$container = null\r\n\t\r\n\t\t@show: ($target) ->\r\n\t\t\ttop = $target.offset().top\r\n\t\r\n\t\t\t# Show placeholder under actual element\r\n\t\t\tif $.fn.spectro.draggedElementDropBefore is false\r\n\t\t\t\ttop += $target.outerHeight()\r\n\t\r\n\t\t\t$container\r\n\t\t\t\t.addClass 'spectro-placeholder--active'\r\n\t\t\t\t.css\r\n\t\t\t\t\ttop: top\r\n\t\t\t\t\tleft: $target.offset().left\r\n\t\t\t\t\twidth: $target.outerWidth()\n\r\t# Spectro popover helper\r\n\tclass Spectro.Popover\r\n\t\t$container = null\r\n\t\r\n\t\t@get: ->\r\n\t\t\tif not $container?\r\n\t\t\t\t$container = $ '''\r\n\t\t\t\t\t<div class=\"spectro-popover spectro-helper\">\r\n\t\t\t\t\t\t<ul class=\"spectro-popover__list\">\r\n\t\t\t\t\t\t\t<li class=\"spectro-popover__list-item\">\r\n\t\t\t\t\t\t\t\t<span class=\"spectro-icon spectro-icon--clearformat\">\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t'''\r\n\t\t\t\t.appendTo 'body'\r\n\t\r\n\t\t\treturn @\r\n\t\r\n\t\t@destroy: ->\r\n\t\t\tif $container?\r\n\t\t\t\t$container.remove()\r\n\t\t\t\t$container = null\r\n\t\r\n\t\t@show: ($target) ->\r\n\t\r\n\t\t\t# Get list of allowed elements\r\n\t\t\t$scheme = $target.data 'scheme'\r\n\t\r\n\t\t\tif $scheme.children().length is 0 then return\r\n\t\r\n\t\t\t# Show popover\r\n\t\t\t$container.addClass 'spectro-popover--active'\r\n\t\r\n\t\t\t$window = $ window\r\n\t\t\tscrollLeft = $window.scrollLeft()\r\n\t\t\tscrollTop = $window.scrollTop()\r\n\t\t\tselection = $target.selection()\r\n\t\t\trange = selection.getRangeAt(0)\r\n\t\t\tbox = range.cloneRange().getBoundingClientRect()\r\n\t\r\n\t\t\t# Reset prev. elements\r\n\t\t\t@clean()\r\n\t\r\n\t\t\t# Double check\r\n\t\t\tif $scheme.attr('spectro-editable') isnt 'true' then return\r\n\t\r\n\t\t\tdrops = []\r\n\t\r\n\t\t\t# Add `clean markup` action\r\n\t\t\t#drops.push $('<li class=\"spectro-popover__list-item\"><span></span></li>')\r\n\t\r\n\t\t\tpopover = this\r\n\t\r\n\t\t\t# Collect drops\r\n\t\t\t$scheme.children().each ->\r\n\t\t\t\t$element = $ this\r\n\t\t\t\ttagName = $element.prop 'tagName'\r\n\t\r\n\t\t\t\t$label = $('<span />').text($element.attr 'spectro-label')\r\n\t\r\n\t\t\t\t# Append empty dummy to copy styles\r\n\t\t\t\t$ghost = $ '<' + tagName + ' />'\r\n\t\t\t\t$ghost.appendTo $target\r\n\t\r\n\t\t\t\tfor property in [ 'font', 'text-decoration', 'text-transform', 'color', 'background' ]\r\n\t\t\t\t\t$label.css property, $ghost.css property\r\n\t\r\n\t\t\t\t# Remove dummy\r\n\t\t\t\t$ghost.remove()\r\n\t\r\n\t\t\t\t# Append drop\r\n\t\t\t\t$drop = $ '<li class=\"spectro-popover__list-item\"></li>'\r\n\t\t\t\t$drop\r\n\t\t\t\t\t.append $label\r\n\t\t\t\t\t.on 'mousedown touchstart', ->\r\n\t\t\t\t\t\t$newElement = $ '<' + tagName + ' />'\r\n\t\r\n\t\t\t\t\t\t# Keep only default attributes and remove `spectro-*` related stuff\r\n\t\t\t\t\t\tfor attribute in $element.get(0).attributes\r\n\t\t\t\t\t\t\tif not attribute.name.startsWith 'spectro-'\r\n\t\t\t\t\t\t\t\t$newElement.attr attribute.name, attribute.value\r\n\t\r\n\t\t\t\t\t\ttry\r\n\t\t\t\t\t\t\tselection.getRangeAt(0).cloneRange().surroundContents($newElement.get(0))\r\n\t\t\t\t\t\tcatch error\r\n\t\r\n\t\t\t\t# Register drop\r\n\t\t\t\tpopover.add $drop\r\n\t\r\n\t\t\t# Move popover to target\r\n\t\t\t$container.css\r\n\t\t\t\tleft: (scrollLeft + box.left + (box.width / 2) - ($container.outerWidth() / 2)) + 'px'\r\n\t\t\t\ttop: (scrollTop + box.top) + 'px'\r\n\t\r\n\t\t@hide: ->\r\n\t\t\tif $container?\r\n\t\t\t\t$container.removeClass 'spectro-popover--active'\r\n\t\r\n\t\t@clean: ->\r\n\t\t\t$container\r\n\t\t\t\t.find '.spectro-popover__list'\r\n\t\t\t\t.html('')\r\n\t\r\n\t\t@add: ($element) ->\r\n\t\t\t$container\r\n\t\t\t\t.find '.spectro-popover__list'\r\n\t\t\t\t.append $element\n\r\r\n$.extend $.expr[':'],\r\n\r\n\r\n\r\n\t# Spectro `:void` selector helper\r\n\r\n\t# Checks if set element is self-closing\r\n\r\n\t'void': (element) ->\r\n\r\n\t\t[ 'area', 'base', 'br', 'col', 'command',\r\n\r\n\t\t  'embed', 'hr', 'img', 'input', 'keygen',\r\n\r\n\t\t  'link', 'meta', 'param', 'source', 'track',\r\n\r\n\t\t  'wbr' ].indexOf(element.tagName.toLowerCase()) > -1\r\n\r\n\r\n\r\n\t# Spectro `:spectro-editable` selector helper\r\n\r\n\t# Checks if set element is contenteditable\r\n\r\n\t'spectro-editable': (element) ->\r\n\r\n\t\t$element = $ element\r\n\r\n\t\t$scheme = $element.data 'scheme'\r\n\r\n\t\t\r\n\r\n\t\treturn not $scheme.is(':void') and\r\n\r\n\t\t\t   $element.parent().hasClass $.fn.spectro.defaults.enabledElementClass or\r\n\r\n\t\t\t   $scheme.attr('spectro-editable') is 'true' and $scheme.children().length is 0\r\n\r\n\r\n\r\n\t# TODO:\r\n\r\n\t'spectro-setupable': (element) -> true\r\n\r\n\r\n\r\n\t# Spectro `:spectro-draggable` selector helper\r\n\r\n\t# Checks of element can be moved\r\n\r\n\t'spectro-draggable': (element) ->\r\n\r\n\t\tif $this.attr('data-spectro-scheme') isnt null or\r\n\r\n\t\t   $this.parent().children().length is 1\r\n\r\n\t\t\treturn false\r\n\r\n\t\telse\r\n\r\n\t\t\treturn true\r\n\r\n\r\n\r\n\t# Spectro `:spectro-removeable` selector helper\r\n\r\n\t# Checks if element can be removed\r\n\r\n\t'spectro-removeable': (element) -> $this.attr('data-spectro-scheme') is null\r\n\r\n\r\n\r\n\t# Spectro `:spectro-controlable` selector helper\r\n\r\n\t# Checks if controls are allowed for set element\r\n\r\n\t'spectro-controlable': (element) ->\r\n\r\n\t\t$element =  $ element\r\n\r\n\r\n\r\n\t\t# Prevent controls for active, removed and dragged elements\r\n\r\n\t\treturn $element.parents(':focus').length is 0 and\r\n\r\n\t\t\t\tnot $element.hasClass $.fn.spectro.defaults.removedElementClass and\r\n\r\n\t\t\t\tnot $element.hasClass $.fn.spectro.defaults.draggedElementClass and\r\n\r\n\t\t\t\tnot $element.is ':focus'\r\n\r\n\t\t\t\t\r\n\r\n\t# Spectro `:spectro-inline` selector helper\r\n\r\n\t# Checks if element is inline\r\n\r\n\t'spectro-inline': (element) ->\r\n\r\n\t\t$element = $ element\r\n\r\n\r\n\r\n\t\t# This filter checks for `spectro-editable` parents\r\n\r\n\t\tfilter = ->\r\n\r\n\t\t\t$scheme = $(this).data 'scheme'\r\n\r\n\r\n\r\n\t\t\treturn $scheme.attr('spectro-label')? and\r\n\r\n\t\t\t\t   $scheme.attr('spectro-editable') is 'true'\r\n\r\n\r\n\r\n\t\t# Check if set element has `spectro-editable` container\r\n\r\n\t\treturn $element.parents('.' + $.fn.spectro.defaults.enabledElementClass).filter(filter).length isnt 0\n\r\n\r\n# String prototype extension\r\nString::startsWith ?= (s) -> @[...s.length] is s\r\nString::endsWith   ?= (s) -> s is '' or @[-s.length..] is s\r\n\r\n# Text selection polyfill\r\n(($) ->\r\n\t$.fn.selection = ->\r\n\t\tselection = window.getSelection()\r\n\r\n\t\t# Check if selection is not empty\r\n\t\tif selection.isCollapsed is true or\r\n\t\t   selection.toString().replace(/\\s/g, '')  is ''\r\n\t\t\treturn null\r\n\r\n\t\t# Search for editable element\r\n\t\t$element = $(selection.anchorNode.parentElement)\r\n\t\t$element = $element.parents('.' + $.fn.spectro.defaults.enabledElementClass).is(':spectro-editable')\r\n\r\n\t\tif $element.length is 0 then return null\r\n\r\n\t\treturn selection\r\n)(jQuery)\r\n\r\n# Spectro plugin\r\n(($) ->\r\n\r\n\t# Global document events\r\n\t$(document).on 'mouseup.spectro mouseleave.spectro touchend.spectro touchcancel.spectro', ->\r\n\r\n\t\t# Hide popover\r\n\t\tSpectro.Popover.hide()\r\n\r\n\t\tif $.fn.spectro.isDrag and\r\n\t\t   $.fn.spectro.$draggedElement?\r\n\r\n\t\t\t# Remove drag class from draggable element\r\n\t\t\t$.fn.spectro.$draggedElement.removeClass $.fn.spectro.defaults.draggedElementClass\r\n\r\n\t\t\t# Remove drag class from document to show controls\r\n\t\t\t$('html').removeClass $.fn.spectro.defaults.documentDraggedClass\r\n\r\n\t\t\t# Drop drag element after target\r\n\t\t\t# TODO: Sometimes $.fn.spectro.$lastDragoveredElement is undefined for some reason\r\n\t\t\tif $.fn.spectro.$lastDragoveredElement?\r\n\t\t\t\tif $.fn.spectro.draggedElementDropBefore is true\r\n\t\t\t\t\t$.fn.spectro.$lastDragoveredElement.before $.fn.spectro.$draggedElement\r\n\t\t\t\telse\r\n\t\t\t\t\t$.fn.spectro.$lastDragoveredElement.after $.fn.spectro.$draggedElement\r\n\r\n\t\t\t# Remove placeholder\r\n\t\t\tSpectro.Placeholder.destroy()\r\n\r\n\t\t\t$.fn.spectro.isDrag = false\r\n\t\t\t$.fn.spectro.$draggedElement = null\r\n\t\t\t$.fn.spectro.$lastDragoveredElement = null\r\n\t\t\t$.fn.spectro.draggedElementDropBefore = false\r\n\r\n\t# Plugin methods\r\n\tmethods =\r\n\r\n\t\t# Enables Spectro chain\r\n\t\tenable: (options) ->\r\n\r\n\t\t\t# Singleton helpers\r\n\t\t\tbreadcrumbs = Spectro.Breadcrumbs.get()\r\n\r\n\t\t\t# Get root element instead of whole xml document\r\n\t\t\tscheme = options.scheme\r\n\r\n\t\t\tif scheme instanceof XMLDocument\r\n\t\t\t\tscheme = scheme.firstChild\r\n\r\n\t\t\t$scheme = $ scheme\r\n\t\t\t$this = $ this\r\n\r\n\t\t\t# Bind scheme before any helpers creation\r\n\t\t\t$this.data 'scheme', $scheme\r\n\r\n\t\t\t# Check if this is component\r\n\t\t\tif $scheme.attr('spectro-label')?\r\n\r\n\t\t\t\t# Create controls for active element\r\n\t\t\t\tcontrols = new Spectro.Controls $this\r\n\r\n\t\t\t\t# Add class to document\r\n\t\t\t\t$('html').addClass $.fn.spectro.defaults.documentEnabledClass;\r\n\r\n\t\t\t\t# No setup required for inline stuff\r\n\t\t\t\tif $this.is ':spectro-inline' then return\r\n\r\n\t\t\t\t$this\r\n\t\t\t\t\t.attr\r\n\t\t\t\t\t\ttabindex: 0\r\n\t\t\t\t\t\t'aria-label': $scheme.attr 'spectro-label'\r\n\t\t\t\t\t.addClass $.fn.spectro.defaults.enabledElementClass\r\n\t\t\t\t\t.trigger 'spectro.enable'\r\n\t\t\t\t\t.on 'mousemove.spectro touchmove.spectro', (event) ->\r\n\t\t\t\t\t\tplaceholder = Spectro.Placeholder.get()\r\n\t\t\t\t\t\t$this = $ this\r\n\r\n\t\t\t\t\t\t# Prevent root element to be focused\r\n\t\t\t\t\t\t#if not $this.parent().hasClass $.fn.spectro.defaults.enabledElementClass then return\r\n\t\t\t\t\t\tif $this.attr('data-spectro-scheme')? then return\r\n\r\n\t\t\t\t\t\t# If this is drag action\r\n\t\t\t\t\t\tif $.fn.spectro.isDrag and\r\n\t\t\t\t\t\t   $.fn.spectro.$draggedElement isnt null\r\n\r\n\t\t\t\t\t\t\t# Add drag class to target\r\n\t\t\t\t\t\t\t$.fn.spectro.$draggedElement.addClass $.fn.spectro.defaults.draggedElementClass\r\n\r\n\t\t\t\t\t\t\t# Add drag class to document to hide controls\r\n\t\t\t\t\t\t\t$('html').addClass $.fn.spectro.defaults.documentDraggedClass\r\n\r\n\t\t\t\t\t\t\t# If element is allowed here\r\n\t\t\t\t\t\t\tif $this.spectro 'accepts', $.fn.spectro.$draggedElement\r\n\r\n\t\t\t\t\t\t\t\t# Decide where to drop element (before or after)\r\n\t\t\t\t\t\t\t\tif event.pageY > $this.offset().top + $this.outerHeight() / 2\r\n\t\t\t\t\t\t\t\t\t$.fn.spectro.draggedElementDropBefore = false\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t$.fn.spectro.draggedElementDropBefore = true\r\n\r\n\t\t\t\t\t\t\t\t$.fn.spectro.$lastDragoveredElement = $this\r\n\r\n\t\t\t\t\t\t\t\tplaceholder.show $this\r\n\r\n\t\t\t\t\t\t# If regular mouse enter\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tevent.stopPropagation()\r\n\t\t\t\t\t\t\tcontrols.show()\r\n\r\n\t\t\t\t\t\t\t# Make element content editable (if allowed) on mouseover to prevent\r\n\t\t\t\t\t\t\t# caret to disappear in Firefox\r\n\t\t\t\t\t\t\tif $this.is ':spectro-editable'\r\n\t\t\t\t\t\t\t\t$this.attr contenteditable: true\r\n\t\t\t\t\t\r\n\t\t\t\t\t.on 'mouseup.spectro touchend.spectro', (event) ->\r\n\t\t\t\t\t\t$this = $ this\r\n\t\t\t\t\t\tpopover = Spectro.Popover.get()\r\n\t\t\t\t\t\tselection = $this.selection()\r\n\r\n\t\t\t\t\t\t# If element is active, contenteditable and has text selected\r\n\t\t\t\t\t\t#console.log $this.selection() isnt null\r\n\t\t\t\t\t\tif $this.is(':focus') and\r\n\t\t\t\t\t\t   selection isnt null\r\n\t\t\t\t\t\t\tevent.stopPropagation()\r\n\r\n\t\t\t\t\t\t\t# Remove trailing whitespace then doubleclick word on windows\r\n\t\t\t\t\t\t\tif /(.+)(\\s{1,})/g.test selection.toString()\r\n\r\n\t\t\t\t\t\t\t\t# Count whitespaces from back\r\n\t\t\t\t\t\t\t\tstring = selection.toString();\r\n\t\t\t\t\t\t\t\tspacesCount = 0\r\n\r\n\t\t\t\t\t\t\t\ti = string.length\r\n\r\n\t\t\t\t\t\t\t\twhile i--\r\n\t\t\t\t\t\t\t\t\tif /\\s/.test string[i]\r\n\t\t\t\t\t\t\t\t\t\tspacesCount++\r\n\t\t\t\t\t\t\t\t\telse break\r\n\r\n\t\t\t\t\t\t\t\t# Create new selection\r\n\t\t\t\t\t\t\t\trange = selection.getRangeAt(0).cloneRange()\r\n\t\t\t\t\t\t\t\trange.setEnd range.endContainer, range.endOffset - spacesCount\r\n\r\n\t\t\t\t\t\t\t\tselection.removeAllRanges()\r\n\t\t\t\t\t\t\t\tselection.addRange(range)\r\n\r\n\t\t\t\t\t\t\t# Show popover if required\r\n\t\t\t\t\t\t\tpopover.show $this\r\n\r\n\t\t\t\t\t.on 'mouseleave.spectro', (event) ->\r\n\t\t\t\t\t\tevent.stopPropagation()\r\n\r\n\t\t\t\t\t\t$this = $ this\r\n\r\n\t\t\t\t\t\tif not $this.is ':focus'\r\n\t\t\t\t\t\t\t$this.removeAttr 'contenteditable'\r\n\t\t\t\t\t\t\tcontrols.hide()\r\n\t\t\t\t\t\r\n\t\t\t\t\t.on 'focus.spectro', (event) ->\r\n\t\t\t\t\t\tevent.preventDefault()\r\n\r\n\t\t\t\t\t\tif not $this.is ':spectro-controlable' then return\r\n\r\n\t\t\t\t\t\t$this = $ this\r\n\t\t\t\t\t\t$this.addClass $.fn.spectro.defaults.activeElementClass\r\n\r\n\t\t\t\t\t\t# If element is not contenteditable yet\r\n\t\t\t\t\t\tif $this.is(':spectro-editable') and $this.attr('contenteditable') isnt 'true'\r\n\t\t\t\t\t\t\t$this.attr contenteditable: true\r\n\r\n\t\t\t\t\t\t# Clean helpers\r\n\t\t\t\t\t\tbreadcrumbs.reset()\r\n\t\t\t\t\t\tcontrols.show()\r\n\r\n\t\t\t\t\t\t# TODO: Move this to breadcrumbs helper class\r\n\t\t\t\t\t\t# Compile parents path\r\n\t\t\t\t\t\t$parent = $this\r\n\t\t\t\t\t\tpath = []\r\n\r\n\t\t\t\t\t\twhile $parent.hasClass($.fn.spectro.defaults.enabledElementClass) and $parent[0] isnt document\r\n\t\t\t\t\t\t\tpath.push $parent\r\n\t\t\t\t\t\t\t$parent = $parent.parent()\r\n\r\n\t\t\t\t\t\tpath.reverse()\r\n\r\n\t\t\t\t\t\t$(path).each ->\r\n\t\t\t\t\t\t\t$item = $ this\r\n\t\t\t\t\t\t\tlabel = $item.data('scheme').attr('spectro-label') or $item.prop('tagName')\r\n\t\t\t\t\t\t\tindex = $item.index $item.prop 'tagName'\r\n\t\t\t\t\t\t\tindex += 1\r\n\r\n\t\t\t\t\t\t\tif index isnt 1\r\n\t\t\t\t\t\t\t\tlabel += ' #' + index\r\n\r\n\t\t\t\t\t\t\tbreadcrumbs.add label, (-> $item.focus())\r\n\r\n\t\t\t\t\t\tbreadcrumbs.show()\r\n\t\t\t\t\t\r\n\t\t\t\t\t.on 'blur.spectro', ->\r\n\t\t\t\t\t\tcontrols.hide()\r\n\r\n\t\t\t\t\t\t$ this\r\n\t\t\t\t\t\t\t.removeAttr 'contenteditable'\r\n\t\t\t\t\t\t\t.removeClass $.fn.spectro.defaults.activeElementClass\r\n\t\t\t\t\t\r\n\t\t\t\t\t.on 'keydown.spectro', (event) ->\r\n\t\t\t\t\t\t$this = $ this\r\n\r\n\t\t\t\t\t\t# Clone element instead of messy markup on `Enter` hit\r\n\t\t\t\t\t\tif event.keyCode is 13\r\n\t\t\t\t\t\t\tevent.preventDefault()\r\n\t\t\t\t\t\t\tevent.stopPropagation()\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t$clone = $ '<' + $this.prop('tagName') + ' />'\r\n\r\n\t\t\t\t\t\t\t$this.after $clone\r\n\r\n\t\t\t\t\t\t\t$clone\r\n\t\t\t\t\t\t\t\t.html ''\r\n\t\t\t\t\t\t\t\t.spectro 'enable', scheme: $this.data('scheme')\r\n\r\n\t\t\t\t\t\t\t$clone.focus()\r\n\r\n\t\t\t\t\t\t\treturn false\r\n\r\n\t\t\t\t\t\t# Remove empty element on `Delete` or `Backspace` hit\r\n\t\t\t\t\t\telse if event.keyCode is 46 or\t# Delete\r\n\t\t\t\t\t\t\t\tevent.keyCode is 8\t\t# Backspace\r\n\r\n\t\t\t\t\t\t\t# Only if element is empty\r\n\t\t\t\t\t\t\tif $this.html() is ''\r\n\t\t\t\t\t\t\t\tevent.preventDefault()\r\n\t\t\t\t\t\t\t\tevent.stopPropagation()\r\n\r\n\t\t\t\t\t\t\t\t$this\r\n\t\t\t\t\t\t\t\t\t.blur()\r\n\t\t\t\t\t\t\t\t\t.remove()\r\n\t\t\t\t\t\r\n\t\t\t\t\t.on 'paste.spectro', (event) ->\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tevent.stopPropagation();\r\n\r\n\t\t\t\t\t\t# Allow plain text insertion only \r\n\t\t\t\t\t\tdocument.execCommand 'insertHTML', false, event.originalEvent.clipboardData.getData 'text/plain'\r\n\r\n\t\t\t# Proceed spectro enable for children\r\n\t\t\t$this.children().each ->\r\n\t\t\t\t$child = $ this\r\n\t\t\t\tchildTagName = $child.prop('tagName').toLowerCase()\r\n\r\n\t\t\t\t$child.spectro 'enable', scheme: $scheme.find('> ' + childTagName).get 0\r\n\r\n\t\t# Checks if element accepts another\r\n\t\taccepts: ($element) -> $(this).data('scheme').parent().find('> [spectro-label=\"' + $element.data('scheme').attr('spectro-label') + '\"]').length isnt 0\r\n\r\n\t\t# Disables Spectro chain\r\n\t\tdisable: ->\r\n\t\t\t$('html').removeClass $.fn.spectro.defaults.documentEnabledClass;\r\n\r\n\t\t\t$ this\r\n\t\t\t\t.removeClass $.fn.spectro.defaults.enabledElementClass\r\n\t\t\t\t.removeAttr 'tabindex'\r\n\t\t\t\t.removeAttr 'aria-label'\r\n\t\t\t\t.off '.spectro'\r\n\t\t\t\t.trigger 'spectro.disable'\r\n\t\t\t\t.children().each ->\r\n\t\t\t\t\t$(this).spectro 'disable'\r\n\r\n\t\t\t# Clean all helpers\r\n\t\t\tSpectro.Helper.clean()\r\n\t\t\tSpectro.Breadcrumbs.destroy()\r\n\t\t\tSpectro.Placeholder.destroy()\r\n\r\n\t\t# Checks if Spectro chain enabled\r\n\t\tenabled: -> $(this).hasClass $.fn.spectro.defaults.enabledElementClass\r\n\r\n\t\t# Checks if Spectro chain disabled\r\n\t\tdisabled: -> not $element.spectro 'enabled'\r\n\r\n\t# Spectro entrypoint method\r\n\t$.fn.spectro = (method, options...) ->\r\n\t\tif methods[method]\r\n\t\t\tmethods[method].apply this, options\r\n\t\telse if typeof method is 'object' or not method\r\n\t\t\tmethods.init.apply this, options\r\n\t\telse\r\n\t\t\tconsole.warn 'Spectro: Unknown method'\r\n\r\n\t# Global variables\r\n\t$.fn.spectro.isDrag = false\r\n\t$.fn.spectro.$draggedElement = null\r\n\t$.fn.spectro.$lastDragoveredElement = null\r\n\t$.fn.spectro.draggedElementDropBefore = false\r\n\r\n\t# Spectro defaults\r\n\t$.fn.spectro.defaults =\r\n\t\tenabledElementClass: 'spectro-element'\r\n\t\thoveredElementClass: 'spectro-element--hover'\r\n\t\tactiveElementClass: 'spectro-element--active'\r\n\t\tremovedElementClass: 'spectro-element--removed'\r\n\t\tdraggedElementClass: 'spectro-element--dragged'\r\n\t\tdocumentEnabledClass: 'spectro--enabled'\r\n\t\tdocumentDraggedClass: 'spectro--dragged'\r\n\r\n\t# Spectro localization stuff\r\n\t$.fn.spectro.i18n =\r\n\t\tremove: 'Remove element'\r\n\t\tsetup: 'Setup element'\r\n\t\tmove: 'Move element'\r\n)(jQuery)",null],"sourceRoot":"/source/"}